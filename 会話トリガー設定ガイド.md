# 🎯 会話トリガー設定ガイド（Unity担当者向け）

## 📋 現在の仕様

### 🚶‍♂️ **自動会話トリガーの条件**

| 項目 | 現在の値 | 説明 |
|------|----------|------|
| **会話開始距離** | 2.5m | この距離以内で会話開始 |
| **会話持続時間** | 6ターン | 1ターン約3秒、計18秒 |
| **会話後クールダウン** | 30秒 | 同じキャラと再会話までの時間 |
| **個人スペース** | 1.5m | 他キャラとの最低距離（重複防止） |
| **チェック間隔** | 0.1秒 | どれくらいの頻度で近接チェックするか |

### 🎪 **お祭り会場での動作例**

```
アルファ：たこ焼き屋台をウロウロ（NavMeshで自動移動）
    ↓
ベータ：金魚すくいから移動してきて接近
    ↓
距離が2.5m以内になる
    ↓
🤖 自動で会話開始！
アルファ：「わぁ、たこ焼き美味しそうですね！」
ベータ：「そうだね、ソースの匂いがいいよね」
（6ターン継続）
    ↓
会話終了、それぞれ別の場所へ移動
    ↓
30秒後：また別のキャラと会話可能に
```

## ⚙️ **設定変更方法**

### 1. **Inspector での設定変更**

各キャラクターの `AdvancedCharacterController.cs` で：

#### 🎯 **会話関連の設定**
```
Conversation Radius: 2.5      ← 【変更可能】会話開始距離
Conversation Cooldown: 30     ← 【変更可能】次の会話までの待機時間（秒）
```

#### 🚶‍♂️ **移動関連の設定**
```
Base Walk Speed: 3.5          ← 【変更可能】歩く速度
Personal Space Radius: 1.5   ← 【変更可能】他キャラとぶつからない距離
Waypoint Reach Distance: 1   ← 【変更可能】目標地点到達判定
Idle Time Min: 3             ← 【変更可能】各地点での最短待機時間
Idle Time Max: 8             ← 【変更可能】各地点での最長待機時間
```

#### 🎨 **デバッグ表示設定**
```
Character Layer: Characters   ← 【必須設定】キャラクター用レイヤー作成
Obstacle Layer: Default       ← 障害物レイヤー
```

### 2. **よくある調整例**

#### 🔥 **もっと頻繁に会話させたい場合**
```
Conversation Radius: 4.0      ← 大きくする（4m以内で開始）
Conversation Cooldown: 15     ← 短くする（15秒で再会話可能）
```

#### 😴 **落ち着いた会話にしたい場合**
```
Conversation Radius: 1.5      ← 小さくする（本当に近くにいる時だけ）
Conversation Cooldown: 60     ← 長くする（1分間はお休み）
```

#### 🏃‍♂️ **もっと活発に動かしたい場合**
```
Base Walk Speed: 5.0          ← 速くする
Idle Time Min: 1              ← 短くする（すぐ移動）
Idle Time Max: 3              ← 短くする
```

#### 🐌 **ゆっくり動かしたい場合**
```
Base Walk Speed: 2.0          ← 遅くする  
Idle Time Min: 5              ← 長くする（各地点でゆっくり）
Idle Time Max: 15             ← 長くする
```

## 🎮 **デバッグ機能**

### **キーボード操作**
- **F1**: システム全体リセット
- **F2**: 強制的にランダムな2人を会話開始
- **F3**: デバッグ情報表示ON/OFF

### **Gizmos表示**
キャラクターを選択すると、Scene Viewで以下が見える：
- 🟢 **緑の円**: 会話開始範囲
- 🟡 **黄色の円**: 個人スペース
- 🔴 **赤い円**: 他キャラ回避範囲
- 🔵 **青い線**: 現在の移動目標
- 🟣 **紫の線**: NavMeshの移動経路

## 🛠️ **トラブルシューティング**

### ❌ **会話が始まらない場合**

1. **NavMesh確認**
   - Window > AI > Navigation
   - 地面が青く表示されているか確認
   - 表示されてない → 地面を「Navigation Static」にしてBake

2. **レイヤー設定確認**
   - キャラクターが「Characters」レイヤーになっているか
   - Inspector の Character Layer が正しく設定されているか

3. **距離確認**
   - Scene View でキャラを選択してGizmosを確認
   - 緑の円（会話範囲）が他キャラに届いているか

### ❌ **キャラが重なってしまう場合**

1. **NavMeshAgent設定**
   - Agent Radius を 0.5 に設定
   - Avoidance Priority を 10-90 でランダムに設定

2. **Personal Space調整**
   - Personal Space Radius を大きくする（2.0等）

### ❌ **会話が多すぎる/少なすぎる場合**

```
多すぎる → Conversation Radius を小さく、Cooldown を大きく
少なすぎる → Conversation Radius を大きく、Cooldown を小さく
```

## 🎯 **推奨設定パターン**

### 🎪 **展示会用（賑やか）**
```
Conversation Radius: 3.0
Conversation Cooldown: 20
Base Walk Speed: 4.0
Idle Time: 2-5秒
```

### 🎨 **デモ用（じっくり観察）**
```
Conversation Radius: 2.5
Conversation Cooldown: 45  
Base Walk Speed: 2.5
Idle Time: 5-10秒
```

### 🐛 **デバッグ用（テスト）**
```
Conversation Radius: 5.0    ← 大きく
Conversation Cooldown: 5    ← 短く
Base Walk Speed: 6.0        ← 速く
```

## 📝 **設定チェックリスト**

- [ ] NavMesh が正しく Bake されている
- [ ] キャラクターに `AdvancedCharacterController.cs` がアタッチされている
- [ ] キャラクターレイヤーが「Characters」に設定されている
- [ ] Character Id が "alpha", "beta", "gamma" になっている
- [ ] FestivalWaypointManager が配置されている
- [ ] サーバーが起動している（`python server/app.py`）
- [ ] F3 でデバッグ情報が表示される

---

**💡 設定に迷ったら、まずは初期設定のまま動作確認してから調整することを推奨します！**